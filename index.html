<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Exposure Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  background:#0b0b0b;
  color:#fff;
  font-family: system-ui, sans-serif;
  padding:30px;
}
h1{
  text-align:center;
  font-size:18px;
  margin-bottom:30px;
  opacity:.9;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:30px;
  max-width:1200px;
  margin:auto;
}
.card{
  background:#111;
  padding:22px;
  border-radius:16px;
}
h2{
  font-size:14px;
  opacity:.7;
  margin-bottom:14px;
}
label{
  font-size:12px;
  opacity:.6;
  margin-top:12px;
  display:block;
}
input, select{
  width:100%;
  padding:10px;
  background:#0b0b0b;
  border:1px solid #333;
  color:#fff;
  border-radius:10px;
  font-size:14px;
}
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.calc-block{
  margin-top:20px;
  padding-top:10px;
  border-top:1px solid #222;
}
.calc-block label{
  opacity:.9;
}
button{
  display:block;
  margin:30px auto 20px;
  padding:12px 36px;
  border-radius:999px;
  border:none;
  background:#fff;
  color:#000;
  font-size:14px;
  cursor:pointer;
}
.result{
  max-width:700px;
  margin:0 auto;
  background:#111;
  border-radius:16px;
  padding:20px;
  font-family: ui-monospace, monospace;
  line-height:1.6;
  opacity:.95;
}
.result strong{
  display:block;
  margin-bottom:6px;
}
</style>
</head>
<body>

<h1>Exposure Calculator</h1>

<div class="grid">

<!-- SOURCE -->
<div class="card">
<h2>Source Exposure</h2>

<label>T-Stop</label>
<input id="l_t" type="number" step="0.01" value="2.8">

<label>ISO</label>
<input id="l_iso" type="number" value="800">

<label>ND (stops)</label>
<input id="l_nd" type="number" step="0.1" value="0.3">

<div class="row">
  <div>
    <label>Shutter Angle (°)</label>
    <input id="l_sh" type="number" value="180">
  </div>
  <div>
    <label>Frame Rate</label>
    <input id="l_fps" type="number" value="25">
  </div>
</div>
</div>

<!-- TARGET -->
<div class="card">
<h2>Target Exposure</h2>

<div class="calc-block">
<strong>Calculate:</strong>
<label><input type="radio" name="calc" value="nd" checked> ND</label>
<label><input type="radio" name="calc" value="iso"> ISO</label>
<label><input type="radio" name="calc" value="t"> T-Stop</label>
<label><input type="radio" name="calc" value="sh"> Shutter Angle</label>
</div>

<label>T-Stop</label>
<input id="r_t" type="number" step="0.01" value="3.6">

<label>ISO</label>
<input id="r_iso" type="number" value="2500">

<label>ND (stops)</label>
<input id="r_nd" type="number" step="0.1" value="0">

<div class="row">
  <div>
    <label>Shutter Angle (°)</label>
    <input id="r_sh" type="number" value="180">
  </div>
  <div>
    <label>Frame Rate</label>
    <input id="r_fps" type="number" value="25">
  </div>
</div>
</div>

</div>

<button onclick="calculate()">CALCULATE</button>

<div class="result" id="result"></div>

<script>
const log2 = x => Math.log(x)/Math.log(2);
const shutterTime = (a,f)=>(a/360)*(1/f);

function exposure(t,iso,nd,sh,fps){
  return log2(iso * shutterTime(sh,fps) / (t*t) / Math.pow(2,nd));
}

const ND_STEPS=[0,0.3,0.6,0.9,1.2,1.5,1.8,2.1,2.4,2.7,3.0];

function nearestND(x){
  return ND_STEPS.reduce((a,b)=>Math.abs(b-x)<Math.abs(a-x)?b:a);
}

function calculate(){
  const base = exposure(+l_t.value,+l_iso.value,+l_nd.value,+l_sh.value,+l_fps.value);
  const mode = document.querySelector("input[name=calc]:checked").value;
  let out = "";

  if(mode==="nd"){
    const exact = log2((+r_iso.value*shutterTime(+r_sh.value,+r_fps.value))/(Math.pow(+r_t.value,2)*Math.pow(2,base)));
    const nd = Math.max(0, nearestND(exact));
    const remaining = exact - nd;

    out += `<strong>Set ND to:</strong> ${nd.toFixed(1)}<br><br>`;

    if(Math.abs(remaining)>0.01){
      out += `<strong>Remaining difference:</strong> ${remaining>0?"+":""}${remaining.toFixed(2)} stop<br><br>`;
      const isoNew = +r_iso.value * Math.pow(2, remaining);
      const tNew = +r_t.value / Math.sqrt(Math.pow(2, remaining));
      out += `Compensate with:<br>`;
      out += `• ISO: ${r_iso.value} → ${Math.round(isoNew)}<br>`;
      out += `• or T-Stop: T${r_t.value} → T${tNew.toFixed(2)}`;
    } else {
      out += `No further compensation needed.`;
    }
  }

  if(mode==="iso"){
    const v = Math.pow(2,base)*Math.pow(+r_t.value,2)*Math.pow(2,+r_nd.value)/shutterTime(+r_sh.value,+r_fps.value);
    out = `<strong>Set ISO to:</strong> ${Math.round(v)}`;
  }

  if(mode==="t"){
    const v = Math.sqrt((+r_iso.value*shutterTime(+r_sh.value,+r_fps.value))/(Math.pow(2,+r_nd.value)*Math.pow(2,base)));
    out = `<strong>Set T-Stop to:</strong> T${v.toFixed(2)}`;
  }

  if(mode==="sh"){
    const v = (Math.pow(2,base)*Math.pow(+r_t.value,2)*Math.pow(2,+r_nd.value)/+r_iso.value)*360*+r_fps.value;
    out = `<strong>Set Shutter Angle to:</strong> ${v.toFixed(1)}°`;
  }

  result.innerHTML = out;
}
</script>

</body>
</html>
